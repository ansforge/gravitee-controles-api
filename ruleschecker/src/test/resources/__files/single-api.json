{
  "id" : "81291589-44e6-39af-925a-a66130af09f7",
  "crossId" : "69549ebe-9384-43c2-949e-be938463c2b3",
  "name" : "API PROXY - DMP",
  "version" : "1.0",
  "description" : "a proxy to reach the DMP via ProSanteConnect",
  "visibility" : "PRIVATE",
  "state" : "STARTED",
  "tags" : [ ],
  "entrypoints" : [ {
    "target" : "https://api.company.com/si-dmp-server/v2/services"
  } ],
  "execution_mode" : "v3",
  "context_path" : "/si-dmp-server/v2/services",
  "proxy" : {
    "virtual_hosts" : [ {
      "path" : "/si-dmp-server/v2/services"
    } ],
    "strip_context_path" : false,
    "preserve_host" : false,
    "logging" : {
      "mode" : "CLIENT_PROXY",
      "content" : "HEADERS_PAYLOADS",
      "scope" : "REQUEST_RESPONSE"
    },
    "groups" : [ {
      "name" : "default-group",
      "endpoints" : [ {
        "proxy" : {
          "type" : "HTTP",
          "useSystemProxy" : true,
          "enabled" : true
        },
        "backup" : false,
        "inherit" : false,
        "name" : "default",
        "weight" : 1,
        "http" : {
          "keepAlive" : true,
          "followRedirects" : false,
          "readTimeout" : 10000,
          "idleTimeout" : 60000,
          "connectTimeout" : 5000,
          "propagateClientAcceptEncoding" : false,
          "useCompression" : true,
          "maxConcurrentConnections" : 100,
          "version" : "HTTP_1_1",
          "pipelining" : false,
          "clearTextUpgrade" : true
        },
        "type" : "http",
        "ssl" : {
          "keyStore" : {
            "certContent" : "-----BEGIN CERTIFICATE-----\nMIIIVTCCBj2gAwIBAgIQHV3iXj3BS95fA7z2vf/OyjANBgkqhkiG9w0BAQsFADCB\nijELMAkGA1UEBhMCRlIxEzARBgNVBAoMCkFTSVAtU0FOVEUxFzAVBgNVBAsMDjAw\nMDIgMTg3NTEyNzUxMRcwFQYDVQQLDA5JR0MtU0FOVEUgVEVTVDE0MDIGA1UEAwwr\nVEVTVCBBQyBJR0MtU0FOVEUgRUxFTUVOVEFJUkUgT1JHQU5JU0FUSU9OUzAeFw0y\nMjA3MDcwNzQ5NDdaFw0yNTA3MDcwNzQ5NDdaMHUxCzAJBgNVBAYTAkZSMRgwFgYD\nVQQIDA9Dw7R0ZS1kJ09yICgyMSkxHjAcBgNVBAoMFU1JTklTVEVSRSBERSBURVNU\nNzcwODEYMBYGA1UECwwPMzAwMDAwMDAwMDc3MDgxMRIwEAYDVQQDDAlhcGktcHJv\neHkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDMeCp2FGSsyZMPVPqe\nA6VKjkWZd/rQbHhvLTpz8C/bgP0FkNMO5fJ8E0Hs0n5v+MbRC6mRlEZfhZNg+SgM\noeTwTGFx7NoVne1kHr8aV9M/BtsXiN6VPw7z+CDg+tBJAkvmbpoYAdlXGsKtnvDQ\n3V2Py9Gyn9cP7jIVyWyaSb2ADQoqavWKVbsavaNucoShUKFNeLqhlsOjB6D7wDZO\nQWWF/8U+HVsKtlgI2zAx8xeAYCNRTCagMgI8v/bmJs4rYFYgEcPTLyhmgR7VPjmq\nxcugPg7IKtTFRpzBEeo5/5k/oCZ/Hw7FkTNqXrycSZbJLCrh6RTwS8owODg+fxLs\npltvAgMBAAGjggPJMIIDxTAJBgNVHRMEAjAAMB0GA1UdDgQWBBQFIVBHms1t2iQc\nib0AGRhZZqKJoTAfBgNVHSMEGDAWgBQhLoR9Ox71Et5RoiFcrpOo71vj9TAOBgNV\nHQ8BAf8EBAMCB4AwUwYDVR0gBEwwSjBIBg0qgXoBgVUBBwIBAQEBMDcwNQYIKwYB\nBQUHAgEWKWh0dHA6Ly9pZ2Mtc2FudGUuZXNhbnRlLmdvdXYuZnIvUEMlMjBURVNU\nMBMGA1UdJQQMMAoGCCsGAQUFBwMCMIIBVQYDVR0fBIIBTDCCAUgwPaA7oDmGN2h0\ndHA6Ly9pZ2Mtc2FudGUuZXNhbnRlLmdvdXYuZnIvQ1JML0FDSS1FTC1PUkctVEVT\nVC5jcmwwggEFoIIBAaCB/oaB+2xkYXA6Ly9hbm51YWlyZS1pZ2MuZXNhbnRlLmdv\ndXYuZnIvY249VEVTVCUyMEFDJTIwSUdDLVNBTlRFJTIwRUxFTUVOVEFJUkUlMjBP\nUkdBTklTQVRJT05TLG91PVRFU1QlMjBBQyUyMFJBQ0lORSUyMElHQy1TQU5URSUy\nMEVMRU1FTlRBSVJFLG91PUlHQy1TQU5URSUyMFRFU1Qsb3U9MDAwMiUyMDE4NzUx\nMjc1MSxvPUFTSVAtU0FOVEUsYz1GUj9jZXJ0aWZpY2F0ZXJldm9jYXRpb25saXN0\nO2JpbmFyeT9iYXNlP29iamVjdENsYXNzPXBraUNBMIIBDgYDVR0uBIIBBTCCAQEw\ngf6ggfuggfiGgfVsZGFwOi8vYW5udWFpcmUtaWdjLmVzYW50ZS5nb3V2LmZyL2Nu\nPVRFU1QlMjBBQyUyMElHQy1TQU5URSUyMEVMRU1FTlRBSVJFJTIwT1JHQU5JU0FU\nSU9OUyxvdT1URVNUJTIwQUMlMjBSQUNJTkUlMjBJR0MtU0FOVEUlMjBFTEVNRU5U\nQUlSRSxvdT1JR0MtU0FOVEUlMjBURVNULG91PTAwMDIlMjAxODc1MTI3NTEsbz1B\nU0lQLVNBTlRFLGM9RlI/ZGVsdGFyZXZvY2F0aW9ubGlzdDtiaW5hcnk/YmFzZT9v\nYmplY3RDbGFzcz1wa2lDQTCBgQYIKwYBBQUHAQEEdTBzMCYGCCsGAQUFBzABhhpo\ndHRwOi8vb2NzcC5lc2FudGUuZ291di5mcjBJBggrBgEFBQcwAoY9aHR0cDovL2ln\nYy1zYW50ZS5lc2FudGUuZ291di5mci9BQyUyMFRFU1QvQUNJLUVMLU9SRy1URVNU\nLmNlcjAPBggqgXoBRwECBQQDBAGDMA0GCSqGSIb3DQEBCwUAA4ICAQCntyzGHstb\niZKlu4p8rSES5KLddiN1/PuVGvNgC7bHRHwi4gWMi99O9wmzosx4kZh0vioTPFaX\nF/N8LNyhy31pFA3q3oWehEXYYyz7k2P2aVzvlxdRf4T4nnjRQATkreokkgLJ+osP\nL/MfRgf3U21gO14SEGrL64rcrh6LhFPdohe0qjif1If40kUVnUQxuhM8RoE0MyrG\nY7mGTojzjy9shAh7pX/NFrzGLwnLCPkjCxPk3U1jkuy9HaEFr/2ESKBFf79lgXcz\n9Npafcmc6yNZJEF9pQmhodl34WWb6spDwkuMVwCZHMlxGFJjltTkFjZrxUdFzEaP\nARGIw9EmZbEC3r9Iuu9F5OqAEEBWu/kUZ/Utn84ilOjLcA4glW9IxA229IO/y0RX\n1rGqTy9fttHvzapwwg0G2j4T618/xycg9x0+vR6rHEzyxPzt3Hsym7NSEYUtuAI6\nmBHJ1tEZV/lGkxF3v7mQCf7zRJPWFC7IZbptpWzVFsm5ruuNBed6nVS1hAVGUEwv\nKR0HiWw4KJbvVoXLTBSsSf3+dvAEIrKfroH1rhuK2t88gqvfkDVqYfd/Ye3arA5k\noIosZoQkXXjU9fZLC23v5SojkjIbIj0ghySV4+Ub94+CO1q5k+7E300hjtZRMaw7\nqZfLC1wB7jqmDxxSG/hpnmHbGNX5exZt4w==\n-----END CERTIFICATE-----\n",
            "keyContent" : "-----BEGIN PRIVATE KEY-----\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDMeCp2FGSsyZMP\nVPqeA6VKjkWZd/rQbHhvLTpz8C/bgP0FkNMO5fJ8E0Hs0n5v+MbRC6mRlEZfhZNg\n+SgMoeTwTGFx7NoVne1kHr8aV9M/BtsXiN6VPw7z+CDg+tBJAkvmbpoYAdlXGsKt\nnvDQ3V2Py9Gyn9cP7jIVyWyaSb2ADQoqavWKVbsavaNucoShUKFNeLqhlsOjB6D7\nwDZOQWWF/8U+HVsKtlgI2zAx8xeAYCNRTCagMgI8v/bmJs4rYFYgEcPTLyhmgR7V\nPjmqxcugPg7IKtTFRpzBEeo5/5k/oCZ/Hw7FkTNqXrycSZbJLCrh6RTwS8owODg+\nfxLspltvAgMBAAECggEARWr+r3wY+fitruTg+Uivk3Jd+s6bHqvU75nhYH9JIDLY\ntE0I+uPiwXEgTrDgME+74DkfZsd6ZO/Kq3+rsy47tcGYy77oA7LMZ9NwehcbJyjC\ntWjIeM8h2n6BWyCMGl1nO2KNel0WVtZFBgESLTcajrlaBlTyBPyPkIoEDxW9+nzX\naYlVwRkkQaODHjk2TAHzIEVxMoNzhOYxzt2Yp+UNXYXyPhGpCHF4iGCJC1IGFuVk\nwGektEsiifCeYcoospWFXShOBFuCxL/CJyXLk4P7g8jb8c7YeXebqStr1YDj/2Wv\nJmNZtVcvUfzY67xKhDLeg+jNWmuR0m1XmpaDlO0LIQKBgQDsZgh/BJDOeHEvD2+A\n/RMFtW3qNDoS1RVUDRfOottM17G/lvVwZclFx1X0FDzIgOseryABy+RJQCNwuNMy\nz8J5Ipx4lEXsifVYsJgN73E2inCTN7DtSUZX5x2vg2R+wGzxdqU3/F0g6feTLIMB\n62IHunY6DixCteeFlsf8KkNTZwKBgQDdbGGM+f0aKgtqhn7JIgpNfcHCdbsPMUoO\nptLX2uuduahAeDDsnzyKd+ge6p1qztE6ab6NNYFCGS2VUFIJV9E5lFi/GYXzTdjl\ntENIgPS6jNXiiC7cgSGw+ORFYT+1Z7tzTPmBFYteiku+uhCm2wMmpJGPfAL+E+be\nbF4r6cB6uQKBgQDXbFvNtBFpteQeqIhKGVVeXGkfhhxt0PQwtgW97ja+HckC+MQN\nexQhnHc9h7ukU6bvPVODj5QnFGW3cRY1NZLY5KuGTkgyN7325maKPGsE8r+HyLZY\nZe/OZvRsXuYTg7NDj4UcMcOEHPHZkjSIaUHaHRdj7Ep1OGMVH8R6jODxfQKBgQCF\nSSpnjEwZJdn9Y7yKIl2FTAAIqInTmV309+LPYM6YARwQwsjghvIQgCFQCvZ7RseX\nm/PCWMTYHwPbb6ASU7R0LqJFVn3VebTogNxHlqi6avCNDmD3BxxaxVfTk7if4DNs\nMpe2ZlugqyrxQluntQpuhn3Am2vJuf0tQpplYK4msQKBgQDDs9Z1eBGdRMixSYAd\nRJ7p0v+7YyDZrdoSDIzdM5KyrxFrN+/u+st8vWfhBdFOXIGTPha+rUP+Pwn7kBob\nZMgKIFsRnhU5/w8CtcVR/m6YsYqT+j0DbbnnYhbrgVroXO7rVM13ZIg0XrzPZg0t\nU4V9anUoRwu2b3GOB5W0pPEDtg==\n-----END PRIVATE KEY-----",
            "type" : "PEM"
          },
          "hostnameVerifier" : false,
          "trustStore" : {
            "type" : ""
          },
          "trustAll" : true
        },
        "target" : "https://formation1.lps2.dmp.gouv.fr/si-dmp-server/v2/services"
      } ],
      "load_balancing" : {
        "type" : "ROUND_ROBIN"
      },
      "http" : {
        "connectTimeout" : 5000,
        "idleTimeout" : 60000,
        "keepAlive" : true,
        "readTimeout" : 10000,
        "pipelining" : false,
        "maxConcurrentConnections" : 100,
        "useCompression" : true,
        "followRedirects" : false
      }
    } ]
  },
  "flow_mode" : "DEFAULT",
  "flows" : [ ],
  "plans" : [ {
    "id" : "eba5f697-b8de-3e2d-b92e-567099c03d4f",
    "crossId" : "e841e239-7f1b-462e-81e2-397f1b062e65",
    "name" : "api-proxy-basic-plan",
    "description" : "basic plan for API Proxy",
    "validation" : "AUTO",
    "security" : "KEY_LESS",
    "type" : "API",
    "status" : "PUBLISHED",
    "api" : "81291589-44e6-39af-925a-a66130af09f7",
    "order" : 0,
    "characteristics" : [ ],
    "created_at" : 1691068895065,
    "updated_at" : 1720018643303,
    "published_at" : 1691068895065,
    "paths" : { },
    "flows" : [ {
      "name" : "name",
      "path-operator" : {
        "path" : "/",
        "operator" : "STARTS_WITH"
      },
      "condition" : "",
      "consumers" : [ ],
      "methods" : [ ],
      "pre" : [ {
        "name" : "OAuth2",
        "description" : "Contrôler la validité de l'access token ProSanteConnect",
        "enabled" : true,
        "policy" : "oauth2",
        "configuration" : {"propagateAuthHeader":true,"extractPayload":true,"checkRequiredScopes":false,"modeStrict":true,"oauthResource":"ProSanteConnect"}
      }, {
        "name" : "OpenID Connect - UserInfo",
        "description" : "Récupérer les UserInfos du PS depuis ProSanteConnect",
        "enabled" : true,
        "policy" : "policy-openid-userinfo",
        "configuration" : {"extractPayload":true,"oauthResource":"ProSanteConnect"}
      }, {
        "name" : "ANS API Proxy",
        "description" : "Générer et signer un jeton VIHF à partir des User Infos",
        "enabled" : true,
        "policy" : "api-proxy",
        "configuration" : {"lpsName":"api-proxy","certificateDN":"CN=api-proxy,OU=300000000077081,O=MINISTERE DE TEST7708,ST=Côte-d'Or (21),C=FR","lpsHomologationNumber":"1","lpsVersion":"1","structureId":"300000000077081","digitalSigningEndpoint":"http://192.168.43.3:9701/esignsante/v1/signatures/xmldsig","clientSecret":"password","useSystemProxy":false,"signingConfigId":"2","useSSL":false}
      }, {
        "name" : "Transform Headers",
        "description" : "Supprimer les headers techniques",
        "enabled" : true,
        "policy" : "transform-headers",
        "configuration" : {"addHeaders":[{"name":"X-API-Proxy-Request-Id","value":"{#request.id}"},{"name":"X-test","value":"azerty"}],"scope":"REQUEST","removeHeaders":["Authorization","X-Gravitee-Request-Id","X-Gravitee-Transaction-Id"]}
      } ],
      "post" : [ ],
      "enabled" : true
    } ],
    "comment_required" : false
  } ],
  "gravitee" : "2.0.0",
  "deployed_at" : 1720018649601,
  "created_at" : 1691068894939,
  "updated_at" : 1720018649601,
  "owner" : {
    "id" : "3e544b5a-5320-4734-944b-5a5320f734ab",
    "email" : "Claire.JUILLARD.EXT@esante.gouv.fr",
    "displayName" : "admin Gravitee.io plateforme POC SCaleway",
    "type" : "USER"
  },
  "properties" : [ ],
  "services" : { },
  "picture_url" : "http://192.168.43.7:26424/management/organizations/DEFAULT/environments/DEFAULT/apis/81291589-44e6-39af-925a-a66130af09f7/picture?hash=1720018649601",
  "resources" : [ {
    "name" : "ProSanteConnect",
    "type" : "oauth2",
    "enabled" : true,
    "configuration" : {"type":"oauth2","enabled":true,"authorizationServerUrl":"https://auth.bas.psc.esante.gouv.fr/auth/realms/esante-wallet/protocol/openid-connect","introspectionEndpoint":"/token/introspect","useSystemProxy":true,"introspectionEndpointMethod":"POST","scopeSeparator":" ","userInfoEndpoint":"/userinfo","userInfoEndpointMethod":"GET","useClientAuthorizationHeader":true,"clientAuthorizationHeaderName":"Authorization","clientAuthorizationHeaderScheme":"Basic","tokenIsSuppliedByQueryParam":false,"tokenQueryParamName":"token","tokenIsSuppliedByHttpHeader":false,"tokenIsSuppliedByFormUrlEncoded":true,"tokenFormUrlEncodedName":"token","userClaim":"sub","clientId":"ans-poc-esignsante-bas","clientSecret":"aa40b822-fa83-4e6b-9460-bfda045c0258"}
  } ],
  "path_mappings" : [ ],
  "response_templates" : { },
  "lifecycle_state" : "CREATED",
  "disable_membership_notifications" : false,
  "background_url" : "http://192.168.43.7:26424/management/organizations/DEFAULT/environments/DEFAULT/apis/81291589-44e6-39af-925a-a66130af09f7/background?hash=1720018649601"
}